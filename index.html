<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, update, remove, onValue } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCaqEmQyEhPGSYqX3Lq8l0Z5dgrG7kNkiE",
            authDomain: "canvaai-database-project-dd70c.firebaseapp.com",
            databaseURL: "https://canvaai-database-project-dd70c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "canvaai-database-project-dd70c",
            storageBucket: "canvaai-database-project-dd70c.firebasestorage.app",
            messagingSenderId: "851493352897",
            appId: "1:851493352897:web:3523b91e7e5fabcb33ab40",
            measurementId: "G-Z2X5JRPZ03"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global variables
        let currentUser = null;
        let currentUserRole = null;

        // Initialize app
        window.addEventListener('DOMContentLoaded', function() {
            showLoginPage();
            initializeSampleData();
        });

        // Initialize sample data
        async function initializeSampleData() {
            try {
                // Sample users
                const usersRef = ref(database, 'users');
                const usersSnapshot = await get(usersRef);
                
                if (!usersSnapshot.exists()) {
                    const sampleUsers = {
                        'admin': { username: 'admin', password: 'admin123', role: 'admin', fullname: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' },
                        'staff01': { username: 'staff01', password: 'staff123', role: 'staff', fullname: '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1' },
                        'somchai': { username: 'somchai', password: 'somchai123', role: 'alumni', fullname: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå' }
                    };
                    await set(usersRef, sampleUsers);
                }

                // Sample alumni data
                const alumniRef = ref(database, 'alumni');
                const alumniSnapshot = await get(alumniRef);
                
                if (!alumniSnapshot.exists()) {
                    const sampleAlumni = {
                        'A001': {
                            alumni_id: 'A001',
                            fullname: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå',
                            major: '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
                            grad_year: '2564',
                            email: 'somchai@gmail.com',
                            phone: '081-234-5678',
                            occupation: '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå',
                            address: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£',
                            username: 'somchai'
                        },
                        'A002': {
                            alumni_id: 'A002',
                            fullname: '‡∏™‡∏∏‡∏î‡∏≤ ‡∏ß‡∏á‡∏®‡πå',
                            major: '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                            grad_year: '2563',
                            email: 'suda@gmail.com',
                            phone: '082-345-6789',
                            occupation: '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà HR',
                            address: '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà',
                            username: 'suda'
                        }
                    };
                    await set(alumniRef, sampleAlumni);
                }

                // Sample activities
                const activitiesRef = ref(database, 'activities');
                const activitiesSnapshot = await get(activitiesRef);
                
                if (!activitiesSnapshot.exists()) {
                    const sampleActivities = {
                        'AC001': {
                            activity_id: 'AC001',
                            title: '‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏™‡∏π‡πà‡πÄ‡∏´‡∏¢‡πâ‡∏≤ 2568',
                            detail: '‡∏û‡∏ö‡∏õ‡∏∞‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤ ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
                            date_event: '2025-12-15',
                            location: '‡∏´‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà'
                        },
                        'AC002': {
                            activity_id: 'AC002',
                            title: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
                            detail: '‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤',
                            date_event: '2025-07-20',
                            location: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° A'
                        }
                    };
                    await set(activitiesRef, sampleActivities);
                }

                // Sample news
                const newsRef = ref(database, 'news');
                const newsSnapshot = await get(newsRef);
                
                if (!newsSnapshot.exists()) {
                    const sampleNews = {
                        'N001': {
                            news_id: 'N001',
                            title: '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏™‡∏π‡πà‡πÄ‡∏´‡∏¢‡πâ‡∏≤ 2568',
                            content: '‡∏Ç‡∏≠‡πÄ‡∏ä‡∏¥‡∏ç‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏™‡∏π‡πà‡πÄ‡∏´‡∏¢‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2568',
                            date_created: '2024-11-15',
                            author: '‡∏ù‡πà‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤'
                        }
                    };
                    await set(newsRef, sampleNews);
                }
            } catch (error) {
                console.error('Error initializing sample data:', error);
            }
        }

        // Authentication functions
        async function login(username, password) {
            try {
                const userRef = ref(database, `users/${username}`);
                const snapshot = await get(userRef);
                
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    if (userData.password === password) {
                        currentUser = username;
                        currentUserRole = userData.role;
                        
                        // Log activity
                        await logActivity(username, '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
                        
                        return { success: true, role: userData.role, fullname: userData.fullname };
                    }
                }
                return { success: false, message: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' };
            } catch (error) {
                console.error('Login error:', error);
                return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' };
            }
        }

        async function register(userData) {
            try {
                // Check if username exists
                const userRef = ref(database, `users/${userData.username}`);
                const snapshot = await get(userRef);
                
                if (snapshot.exists()) {
                    return { success: false, message: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß' };
                }

                // Create user account
                await set(userRef, {
                    username: userData.username,
                    password: userData.password,
                    role: 'alumni',
                    fullname: userData.fullname
                });

                // Create alumni profile
                const alumniId = 'A' + Date.now().toString().slice(-6);
                const alumniRef = ref(database, `alumni/${alumniId}`);
                await set(alumniRef, {
                    alumni_id: alumniId,
                    fullname: userData.fullname,
                    major: userData.major,
                    grad_year: userData.grad_year,
                    email: userData.email,
                    phone: userData.phone || '',
                    occupation: userData.occupation || '',
                    address: userData.address || '',
                    username: userData.username
                });

                return { success: true, message: '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' };
            } catch (error) {
                console.error('Registration error:', error);
                return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' };
            }
        }

        async function logActivity(username, action) {
            try {
                const logRef = ref(database, 'system_logs');
                const newLogRef = push(logRef);
                await set(newLogRef, {
                    username: username,
                    action: action,
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleDateString('th-TH')
                });
            } catch (error) {
                console.error('Log activity error:', error);
            }
        }

        // UI Functions
        function showLoginPage() {
            document.getElementById('app').innerHTML = `
                <div class="min-h-full bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
                    <div class="max-w-md w-full space-y-8">
                        <div class="text-center">
                            <h1 class="text-4xl font-bold text-gray-900 mb-2">üéì</h1>
                            <h2 class="text-3xl font-bold text-gray-900">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</h2>
                            <p class="text-xl text-gray-600 mt-2">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-lg p-8">
                            <div class="mb-6">
                                <div class="flex space-x-1 mb-4">
                                    <button onclick="showLoginForm()" id="loginTab" class="flex-1 py-2 px-4 text-center rounded-lg bg-blue-600 text-white font-medium">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                                    <button onclick="showRegisterForm()" id="registerTab" class="flex-1 py-2 px-4 text-center rounded-lg bg-gray-200 text-gray-700 font-medium">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                                </div>
                            </div>
                            
                            <div id="loginForm">
                                <form onsubmit="handleLogin(event)">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                            <input type="text" id="loginUsername" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                            <input type="password" id="loginPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 font-medium">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                                    </div>
                                </form>
                                
                                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
                                    <div class="text-xs space-y-1">
                                        <p><strong>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö:</strong> admin / admin123</p>
                                        <p><strong>‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£:</strong> staff01 / staff123</p>
                                        <p><strong>‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤:</strong> somchai / somchai123</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="registerForm" class="hidden">
                                <form onsubmit="handleRegister(event)">
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                                <input type="text" id="regUsername" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                                <input type="password" id="regPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                            <input type="text" id="regFullname" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
                                                <select id="regMajor" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                                                    <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                                                    <option value="‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</option>
                                                    <option value="‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°</option>
                                                    <option value="‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö</label>
                                                <select id="regGradYear" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ</option>
                                                    <option value="2567">2567</option>
                                                    <option value="2566">2566</option>
                                                    <option value="2565">2565</option>
                                                    <option value="2564">2564</option>
                                                    <option value="2563">2563</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                                            <input type="email" id="regEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 font-medium">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showLoginForm() {
            document.getElementById('loginTab').className = 'flex-1 py-2 px-4 text-center rounded-lg bg-blue-600 text-white font-medium';
            document.getElementById('registerTab').className = 'flex-1 py-2 px-4 text-center rounded-lg bg-gray-200 text-gray-700 font-medium';
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginTab').className = 'flex-1 py-2 px-4 text-center rounded-lg bg-gray-200 text-gray-700 font-medium';
            document.getElementById('registerTab').className = 'flex-1 py-2 px-4 text-center rounded-lg bg-green-600 text-white font-medium';
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const result = await login(username, password);
            
            if (result.success) {
                showMessage('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                setTimeout(() => {
                    if (result.role === 'admin') {
                        showAdminDashboard();
                    } else if (result.role === 'staff') {
                        showStaffDashboard();
                    } else if (result.role === 'alumni') {
                        showAlumniDashboard();
                    }
                }, 1000);
            } else {
                showMessage(result.message, 'error');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const userData = {
                username: document.getElementById('regUsername').value,
                password: document.getElementById('regPassword').value,
                fullname: document.getElementById('regFullname').value,
                major: document.getElementById('regMajor').value,
                grad_year: document.getElementById('regGradYear').value,
                email: document.getElementById('regEmail').value
            };
            
            const result = await register(userData);
            
            if (result.success) {
                showMessage('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', 'success');
                setTimeout(() => {
                    showLoginForm();
                }, 1500);
            } else {
                showMessage(result.message, 'error');
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Alumni Dashboard
        function showAlumniDashboard() {
            document.getElementById('app').innerHTML = `
                <div class="min-h-full bg-gray-50">
                    <nav class="bg-blue-600 text-white p-4">
                        <div class="flex justify-between items-center">
                            <h1 class="text-xl font-bold">üë®‚Äçüéì ‡∏£‡∏∞‡∏ö‡∏ö‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h1>
                            <button onclick="logout()" class="bg-blue-700 px-4 py-2 rounded hover:bg-blue-800">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                        </div>
                    </nav>
                    
                    <div class="container mx-auto p-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <button onclick="showAlumniProfile()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üë§</div>
                                <h3 class="font-semibold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                            </button>
                            <button onclick="showAlumniSearch()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üîç</div>
                                <h3 class="font-semibold">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h3>
                            </button>
                            <button onclick="showAlumniNews()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üì∞</div>
                                <h3 class="font-semibold">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h3>
                            </button>
                            <button onclick="showAlumniActivities()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üéâ</div>
                                <h3 class="font-semibold">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                            </button>
                        </div>
                        
                        <div id="alumniContent" class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-2xl font-bold mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
                            <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function showAlumniProfile() {
            try {
                const alumniRef = ref(database, 'alumni');
                const snapshot = await get(alumniRef);
                let userProfile = null;
                
                if (snapshot.exists()) {
                    const alumniData = snapshot.val();
                    for (let key in alumniData) {
                        if (alumniData[key].username === currentUser) {
                            userProfile = alumniData[key];
                            break;
                        }
                    }
                }
                
                document.getElementById('alumniContent').innerHTML = `
                    <h2 class="text-2xl font-bold mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
                    <form onsubmit="updateAlumniProfile(event)">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="md:col-span-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</label>
                                <div class="flex flex-col items-center">
                                    <div class="w-32 h-32 bg-gray-200 rounded-full flex items-center justify-center mb-4 overflow-hidden">
                                        ${userProfile?.profileImage ? 
                                            `<img src="${userProfile.profileImage}" alt="Profile" class="w-full h-full object-cover">` : 
                                            '<span class="text-4xl text-gray-400">üë§</span>'
                                        }
                                    </div>
                                    <input type="file" id="profileImageInput" accept="image/*" onchange="handleImageUpload(event)" class="hidden">
                                    <button type="button" onclick="document.getElementById('profileImageInput').click()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
                                    ${userProfile?.profileImage ? 
                                        '<button type="button" onclick="removeProfileImage()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 text-sm mt-2">‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>' : 
                                        ''
                                    }
                                </div>
                            </div>
                            <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                    <input type="text" id="profileFullname" value="${userProfile?.fullname || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
                                    <input type="text" id="profileMajor" value="${userProfile?.major || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö</label>
                                    <input type="text" id="profileGradYear" value="${userProfile?.grad_year || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                                    <input type="email" id="profileEmail" value="${userProfile?.email || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                    <input type="text" id="profilePhone" value="${userProfile?.phone || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                                    <input type="text" id="profileOccupation" value="${userProfile?.occupation || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                                    <textarea id="profileAddress" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">${userProfile?.address || ''}</textarea>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        </div>
                    </form>
                `;
            } catch (error) {
                console.error('Error loading profile:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        // Image upload functions
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    showMessage('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    // Update preview
                    const preview = document.querySelector('.w-32.h-32');
                    if (preview) {
                        preview.innerHTML = `<img src="${imageData}" alt="Profile" class="w-full h-full object-cover">`;
                    }
                    // Store in temporary variable
                    window.tempProfileImage = imageData;
                };
                reader.readAsDataURL(file);
            }
        }

        async function removeProfileImage() {
            try {
                const alumniRef = ref(database, 'alumni');
                const snapshot = await get(alumniRef);
                let alumniKey = null;
                
                if (snapshot.exists()) {
                    const alumniData = snapshot.val();
                    for (let key in alumniData) {
                        if (alumniData[key].username === currentUser) {
                            alumniKey = key;
                            break;
                        }
                    }
                }
                
                if (alumniKey) {
                    const specificAlumniRef = ref(database, `alumni/${alumniKey}`);
                    await update(specificAlumniRef, { profileImage: null });
                    
                    await logActivity(currentUser, '‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå');
                    showMessage('‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    showAlumniProfile(); // Refresh the profile view
                }
            } catch (error) {
                console.error('Error removing profile image:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
            }
        }

        async function updateAlumniProfile(event) {
            event.preventDefault();
            
            try {
                const alumniRef = ref(database, 'alumni');
                const snapshot = await get(alumniRef);
                let alumniKey = null;
                
                if (snapshot.exists()) {
                    const alumniData = snapshot.val();
                    for (let key in alumniData) {
                        if (alumniData[key].username === currentUser) {
                            alumniKey = key;
                            break;
                        }
                    }
                }
                
                if (alumniKey) {
                    const updateData = {
                        fullname: document.getElementById('profileFullname').value,
                        major: document.getElementById('profileMajor').value,
                        grad_year: document.getElementById('profileGradYear').value,
                        email: document.getElementById('profileEmail').value,
                        phone: document.getElementById('profilePhone').value,
                        occupation: document.getElementById('profileOccupation').value,
                        address: document.getElementById('profileAddress').value
                    };
                    
                    // Add profile image if uploaded
                    if (window.tempProfileImage) {
                        updateData.profileImage = window.tempProfileImage;
                        window.tempProfileImage = null; // Clear temp data
                    }
                    
                    const specificAlumniRef = ref(database, `alumni/${alumniKey}`);
                    await update(specificAlumniRef, updateData);
                    
                    await logActivity(currentUser, '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß');
                    showMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        async function showAlumniSearch() {
            document.getElementById('alumniContent').innerHTML = `
                <h2 class="text-2xl font-bold mb-6">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <select id="searchMajor" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                                <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                                <option value="‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</option>
                                <option value="‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°</option>
                                <option value="‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö</label>
                            <select id="searchGradYear" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                                <option value="2567">2567</option>
                                <option value="2566">2566</option>
                                <option value="2565">2565</option>
                                <option value="2564">2564</option>
                                <option value="2563">2563</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
                            <input type="text" id="searchName" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <button onclick="searchAlumni()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </div>
                <div id="searchResults"></div>
            `;
            
            // Load all alumni initially
            searchAlumni();
        }

        async function searchAlumni() {
            try {
                const alumniRef = ref(database, 'alumni');
                const snapshot = await get(alumniRef);
                
                if (snapshot.exists()) {
                    const alumniData = snapshot.val();
                    const searchMajor = document.getElementById('searchMajor').value;
                    const searchGradYear = document.getElementById('searchGradYear').value;
                    const searchName = document.getElementById('searchName').value.toLowerCase();
                    
                    let filteredAlumni = Object.values(alumniData).filter(alumni => {
                        const matchMajor = !searchMajor || alumni.major === searchMajor;
                        const matchYear = !searchGradYear || alumni.grad_year === searchGradYear;
                        const matchName = !searchName || alumni.fullname.toLowerCase().includes(searchName);
                        
                        return matchMajor && matchYear && matchName;
                    });
                    
                    let resultsHTML = `
                        <h3 class="text-lg font-semibold mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (${filteredAlumni.length} ‡∏Ñ‡∏ô)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    `;
                    
                    filteredAlumni.forEach(alumni => {
                        resultsHTML += `
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="flex items-start space-x-4">
                                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden flex-shrink-0">
                                        ${alumni.profileImage ? 
                                            `<img src="${alumni.profileImage}" alt="Profile" class="w-full h-full object-cover">` : 
                                            '<span class="text-2xl text-gray-400">üë§</span>'
                                        }
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-lg">${alumni.fullname}</h4>
                                        <p class="text-gray-600">‡∏™‡∏≤‡∏Ç‡∏≤: ${alumni.major}</p>
                                        <p class="text-gray-600">‡∏õ‡∏µ‡∏à‡∏ö: ${alumni.grad_year}</p>
                                        <p class="text-gray-600">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û: ${alumni.occupation || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                        <p class="text-gray-600">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${alumni.address || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    resultsHTML += '</div>';
                    document.getElementById('searchResults').innerHTML = resultsHTML;
                } else {
                    document.getElementById('searchResults').innerHTML = '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</p>';
                }
            } catch (error) {
                console.error('Error searching alumni:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'error');
            }
        }

        async function showAlumniNews() {
            try {
                const newsRef = ref(database, 'news');
                const snapshot = await get(newsRef);
                
                let newsHTML = `
                    <h2 class="text-2xl font-bold mb-6">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
                `;
                
                if (snapshot.exists()) {
                    const newsData = snapshot.val();
                    const newsList = Object.values(newsData);
                    
                    newsList.forEach(news => {
                        newsHTML += `
                            <div class="bg-gray-50 p-6 rounded-lg mb-4">
                                <h3 class="text-xl font-semibold mb-2">${news.title}</h3>
                                <p class="text-gray-600 mb-2">‡πÇ‡∏î‡∏¢: ${news.author} | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(news.date_created).toLocaleDateString('th-TH')}</p>
                                <p class="text-gray-800">${news.content}</p>
                            </div>
                        `;
                    });
                } else {
                    newsHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
                }
                
                document.getElementById('alumniContent').innerHTML = newsHTML;
            } catch (error) {
                console.error('Error loading news:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
            }
        }

        async function showAlumniActivities() {
            try {
                const activitiesRef = ref(database, 'activities');
                const snapshot = await get(activitiesRef);
                
                let activitiesHTML = `
                    <h2 class="text-2xl font-bold mb-6">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
                `;
                
                if (snapshot.exists()) {
                    const activitiesData = snapshot.val();
                    const activitiesList = Object.values(activitiesData);
                    
                    activitiesList.forEach(activity => {
                        const eventDate = new Date(activity.date_event);
                        const isUpcoming = eventDate > new Date();
                        
                        activitiesHTML += `
                            <div class="bg-gray-50 p-6 rounded-lg mb-4">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-semibold mb-2">${activity.title}</h3>
                                        <p class="text-gray-800 mb-2">${activity.detail}</p>
                                        <p class="text-gray-600">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${eventDate.toLocaleDateString('th-TH')}</p>
                                        <p class="text-gray-600">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${activity.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                    </div>
                                    <div class="ml-4">
                                        <span class="px-3 py-1 rounded-full text-sm ${isUpcoming ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                            ${isUpcoming ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á' : '‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    activitiesHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
                }
                
                document.getElementById('alumniContent').innerHTML = activitiesHTML;
            } catch (error) {
                console.error('Error loading activities:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'error');
            }
        }

        // Staff Dashboard
        function showStaffDashboard() {
            document.getElementById('app').innerHTML = `
                <div class="min-h-full bg-gray-50">
                    <nav class="bg-green-600 text-white p-4">
                        <div class="flex justify-between items-center">
                            <h1 class="text-xl font-bold">üë©‚Äçüíº ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h1>
                            <button onclick="logout()" class="bg-green-700 px-4 py-2 rounded hover:bg-green-800">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                        </div>
                    </nav>
                    
                    <div class="container mx-auto p-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <button onclick="showStaffSearch()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üîç</div>
                                <h3 class="font-semibold">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h3>
                            </button>
                            <button onclick="showStaffReports()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üìä</div>
                                <h3 class="font-semibold">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</h3>
                            </button>
                            <button onclick="showStaffActivities()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üéâ</div>
                                <h3 class="font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                            </button>
                            <button onclick="showStaffNews()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üì∞</div>
                                <h3 class="font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h3>
                            </button>
                        </div>
                        
                        <div id="staffContent" class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-2xl font-bold mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h2>
                            <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function showStaffSearch() {
            document.getElementById('staffContent').innerHTML = `
                <h2 class="text-2xl font-bold mb-6">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <select id="staffSearchMajor" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                                <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                                <option value="‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</option>
                                <option value="‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°</option>
                                <option value="‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö</label>
                            <select id="staffSearchGradYear" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                                <option value="2567">2567</option>
                                <option value="2566">2566</option>
                                <option value="2565">2565</option>
                                <option value="2564">2564</option>
                                <option value="2563">2563</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label>
                            <input type="text" id="staffSearchOccupation" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
                            <input type="text" id="staffSearchName" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <button onclick="staffSearchAlumni()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </div>
                <div id="staffSearchResults"></div>
            `;
            
            staffSearchAlumni();
        }

        async function staffSearchAlumni() {
            try {
                const alumniRef = ref(database, 'alumni');
                const snapshot = await get(alumniRef);
                
                if (snapshot.exists()) {
                    const alumniData = snapshot.val();
                    const searchMajor = document.getElementById('staffSearchMajor').value;
                    const searchGradYear = document.getElementById('staffSearchGradYear').value;
                    const searchOccupation = document.getElementById('staffSearchOccupation').value.toLowerCase();
                    const searchName = document.getElementById('staffSearchName').value.toLowerCase();
                    
                    let filteredAlumni = Object.entries(alumniData).filter(([key, alumni]) => {
                        const matchMajor = !searchMajor || alumni.major === searchMajor;
                        const matchYear = !searchGradYear || alumni.grad_year === searchGradYear;
                        const matchOccupation = !searchOccupation || (alumni.occupation && alumni.occupation.toLowerCase().includes(searchOccupation));
                        const matchName = !searchName || alumni.fullname.toLowerCase().includes(searchName);
                        
                        return matchMajor && matchYear && matchOccupation && matchName;
                    });
                    
                    let resultsHTML = `
                        <h3 class="text-lg font-semibold mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (${filteredAlumni.length} ‡∏Ñ‡∏ô)</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏≤‡∏Ç‡∏≤</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏õ‡∏µ‡∏à‡∏ö</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                    `;
                    
                    filteredAlumni.forEach(([key, alumni]) => {
                        resultsHTML += `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${alumni.fullname}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.major}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.grad_year}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.occupation || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.email}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.phone || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                            </tr>
                        `;
                    });
                    
                    resultsHTML += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    document.getElementById('staffSearchResults').innerHTML = resultsHTML;
                } else {
                    document.getElementById('staffSearchResults').innerHTML = '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</p>';
                }
            } catch (error) {
                console.error('Error searching alumni:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'error');
            }
        }

        async function showStaffReports() {
            try {
                const alumniRef = ref(database, 'alumni');
                const snapshot = await get(alumniRef);
                
                let reportHTML = `<h2 class="text-2xl font-bold mb-6">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>`;
                
                if (snapshot.exists()) {
                    const alumniData = snapshot.val();
                    const alumniList = Object.values(alumniData);
                    
                    // ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏à‡∏ö
                    const yearStats = {};
                    const majorStats = {};
                    const occupationStats = {};
                    
                    alumniList.forEach(alumni => {
                        // ‡∏õ‡∏µ‡∏à‡∏ö
                        yearStats[alumni.grad_year] = (yearStats[alumni.grad_year] || 0) + 1;
                        
                        // ‡∏™‡∏≤‡∏Ç‡∏≤
                        majorStats[alumni.major] = (majorStats[alumni.major] || 0) + 1;
                        
                        // ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û
                        if (alumni.occupation) {
                            occupationStats[alumni.occupation] = (occupationStats[alumni.occupation] || 0) + 1;
                        }
                    });
                    
                    reportHTML += `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-blue-50 p-6 rounded-lg">
                                <h3 class="text-lg font-semibold mb-4 text-blue-800">‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏à‡∏ö</h3>
                    `;
                    
                    Object.entries(yearStats).sort().forEach(([year, count]) => {
                        reportHTML += `<p class="mb-2">‡∏õ‡∏µ ${year}: <span class="font-semibold">${count} ‡∏Ñ‡∏ô</span></p>`;
                    });
                    
                    reportHTML += `
                            </div>
                            <div class="bg-green-50 p-6 rounded-lg">
                                <h3 class="text-lg font-semibold mb-4 text-green-800">‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤</h3>
                    `;
                    
                    Object.entries(majorStats).forEach(([major, count]) => {
                        reportHTML += `<p class="mb-2">${major}: <span class="font-semibold">${count} ‡∏Ñ‡∏ô</span></p>`;
                    });
                    
                    reportHTML += `
                            </div>
                            <div class="bg-purple-50 p-6 rounded-lg">
                                <h3 class="text-lg font-semibold mb-4 text-purple-800">‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</h3>
                    `;
                    
                    Object.entries(occupationStats).slice(0, 5).forEach(([occupation, count]) => {
                        reportHTML += `<p class="mb-2">${occupation}: <span class="font-semibold">${count} ‡∏Ñ‡∏ô</span></p>`;
                    });
                    
                    reportHTML += `
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-blue-600">${alumniList.length}</div>
                                    <div class="text-sm text-gray-600">‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-green-600">${Object.keys(majorStats).length}</div>
                                    <div class="text-sm text-gray-600">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-purple-600">${Object.keys(occupationStats).length}</div>
                                    <div class="text-sm text-gray-600">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-orange-600">${alumniList.filter(a => a.email).length}</div>
                                    <div class="text-sm text-gray-600">‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    reportHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>';
                }
                
                document.getElementById('staffContent').innerHTML = reportHTML;
            } catch (error) {
                console.error('Error loading reports:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'error');
            }
        }

        async function showStaffActivities() {
            document.getElementById('staffContent').innerHTML = `
                <h2 class="text-2xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
                
                <div class="mb-6">
                    <button onclick="showAddActivityForm()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                </div>
                
                <div id="addActivityForm" class="hidden bg-gray-50 p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
                    <form onsubmit="addActivity(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                                <input type="text" id="activityTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                                <input type="date" id="activityDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                                <input type="text" id="activityLocation" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                            <textarea id="activityDetail" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
                            <button type="button" onclick="hideAddActivityForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </form>
                </div>
                
                <div id="activitiesList"></div>
            `;
            
            loadStaffActivities();
        }

        function showAddActivityForm() {
            document.getElementById('addActivityForm').classList.remove('hidden');
        }

        function hideAddActivityForm() {
            document.getElementById('addActivityForm').classList.add('hidden');
            document.getElementById('addActivityForm').querySelector('form').reset();
        }

        async function addActivity(event) {
            event.preventDefault();
            
            try {
                const activityId = 'AC' + Date.now().toString().slice(-6);
                const activityData = {
                    activity_id: activityId,
                    title: document.getElementById('activityTitle').value,
                    detail: document.getElementById('activityDetail').value,
                    date_event: document.getElementById('activityDate').value,
                    location: document.getElementById('activityLocation').value,
                    created_by: currentUser,
                    created_date: new Date().toISOString()
                };
                
                const activityRef = ref(database, `activities/${activityId}`);
                await set(activityRef, activityData);
                
                await logActivity(currentUser, '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà: ' + activityData.title);
                showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                hideAddActivityForm();
                loadStaffActivities();
            } catch (error) {
                console.error('Error adding activity:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'error');
            }
        }

        async function loadStaffActivities() {
            try {
                const activitiesRef = ref(database, 'activities');
                const snapshot = await get(activitiesRef);
                
                let activitiesHTML = '<h3 class="text-lg font-semibold mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>';
                
                if (snapshot.exists()) {
                    const activitiesData = snapshot.val();
                    const activitiesList = Object.entries(activitiesData);
                    
                    activitiesHTML += '<div class="space-y-4">';
                    
                    activitiesList.forEach(([key, activity]) => {
                        const eventDate = new Date(activity.date_event);
                        const isUpcoming = eventDate > new Date();
                        
                        activitiesHTML += `
                            <div class="bg-white border border-gray-200 p-6 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h4 class="text-xl font-semibold mb-2">${activity.title}</h4>
                                        <p class="text-gray-800 mb-2">${activity.detail}</p>
                                        <p class="text-gray-600">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${eventDate.toLocaleDateString('th-TH')}</p>
                                        <p class="text-gray-600">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${activity.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                    </div>
                                    <div class="ml-4 flex flex-col space-y-2">
                                        <span class="px-3 py-1 rounded-full text-sm ${isUpcoming ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                            ${isUpcoming ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á' : '‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß'}
                                        </span>
                                        <button onclick="editActivity('${key}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                        <button onclick="deleteActivity('${key}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    activitiesHTML += '</div>';
                } else {
                    activitiesHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
                }
                
                document.getElementById('activitiesList').innerHTML = activitiesHTML;
            } catch (error) {
                console.error('Error loading activities:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'error');
            }
        }

        async function editActivity(activityId) {
            try {
                const activityRef = ref(database, `activities/${activityId}`);
                const snapshot = await get(activityRef);
                
                if (snapshot.exists()) {
                    const activity = snapshot.val();
                    
                    // Show edit form
                    document.getElementById('addActivityForm').classList.remove('hidden');
                    document.getElementById('addActivityForm').innerHTML = `
                        <h3 class="text-lg font-semibold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                        <form onsubmit="updateActivity(event, '${activityId}')">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                                    <input type="text" id="editActivityTitle" value="${activity.title}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                                    <input type="date" id="editActivityDate" value="${activity.date_event}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                                    <input type="text" id="editActivityLocation" value="${activity.location || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                <textarea id="editActivityDetail" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">${activity.detail}</textarea>
                            </div>
                            <div class="flex space-x-4">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button type="button" onclick="cancelEditActivity()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </form>
                    `;
                }
            } catch (error) {
                console.error('Error loading activity for edit:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'error');
            }
        }

        async function updateActivity(event, activityId) {
            event.preventDefault();
            
            try {
                const updateData = {
                    title: document.getElementById('editActivityTitle').value,
                    detail: document.getElementById('editActivityDetail').value,
                    date_event: document.getElementById('editActivityDate').value,
                    location: document.getElementById('editActivityLocation').value,
                    updated_by: currentUser,
                    updated_date: new Date().toISOString()
                };
                
                const activityRef = ref(database, `activities/${activityId}`);
                await update(activityRef, updateData);
                
                await logActivity(currentUser, '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ' + updateData.title);
                showMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                cancelEditActivity();
                loadStaffActivities();
            } catch (error) {
                console.error('Error updating activity:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'error');
            }
        }

        function cancelEditActivity() {
            document.getElementById('addActivityForm').classList.add('hidden');
            document.getElementById('addActivityForm').innerHTML = `
                <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
                <form onsubmit="addActivity(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                            <input type="text" id="activityTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                            <input type="date" id="activityDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="text" id="activityLocation" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                        <textarea id="activityDetail" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
                        <button type="button" onclick="hideAddActivityForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </form>
            `;
        }

        async function deleteActivity(activityId) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    const activityRef = ref(database, `activities/${activityId}`);
                    await remove(activityRef);
                    
                    await logActivity(currentUser, '‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ' + activityId);
                    showMessage('‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    loadStaffActivities();
                } catch (error) {
                    console.error('Error deleting activity:', error);
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'error');
                }
            }
        }

        async function showStaffNews() {
            document.getElementById('staffContent').innerHTML = `
                <h2 class="text-2xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
                
                <div class="mb-6">
                    <button onclick="showAddNewsForm()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
                </div>
                
                <div id="addNewsForm" class="hidden bg-gray-50 p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
                    <form onsubmit="addNews(event)">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label>
                            <input type="text" id="newsTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</label>
                            <textarea id="newsContent" rows="5" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button>
                            <button type="button" onclick="hideAddNewsForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </form>
                </div>
                
                <div id="newsList"></div>
            `;
            
            loadStaffNews();
        }

        function showAddNewsForm() {
            document.getElementById('addNewsForm').classList.remove('hidden');
        }

        function hideAddNewsForm() {
            document.getElementById('addNewsForm').classList.add('hidden');
            document.getElementById('addNewsForm').querySelector('form').reset();
        }

        async function addNews(event) {
            event.preventDefault();
            
            try {
                const newsId = 'N' + Date.now().toString().slice(-6);
                const newsData = {
                    news_id: newsId,
                    title: document.getElementById('newsTitle').value,
                    content: document.getElementById('newsContent').value,
                    author: currentUser,
                    date_created: new Date().toISOString().split('T')[0]
                };
                
                const newsRef = ref(database, `news/${newsId}`);
                await set(newsRef, newsData);
                
                await logActivity(currentUser, '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£: ' + newsData.title);
                showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                hideAddNewsForm();
                loadStaffNews();
            } catch (error) {
                console.error('Error adding news:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
            }
        }

        async function loadStaffNews() {
            try {
                const newsRef = ref(database, 'news');
                const snapshot = await get(newsRef);
                
                let newsHTML = '<h3 class="text-lg font-semibold mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h3>';
                
                if (snapshot.exists()) {
                    const newsData = snapshot.val();
                    const newsList = Object.entries(newsData);
                    
                    newsHTML += '<div class="space-y-4">';
                    
                    newsList.forEach(([key, news]) => {
                        newsHTML += `
                            <div class="bg-white border border-gray-200 p-6 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h4 class="text-xl font-semibold mb-2">${news.title}</h4>
                                        <p class="text-gray-800 mb-2">${news.content}</p>
                                        <p class="text-gray-600 text-sm">‡πÇ‡∏î‡∏¢: ${news.author} | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(news.date_created).toLocaleDateString('th-TH')}</p>
                                    </div>
                                    <div class="ml-4 flex flex-col space-y-2">
                                        <button onclick="editNews('${key}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                        <button onclick="deleteNews('${key}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    newsHTML += '</div>';
                } else {
                    newsHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
                }
                
                document.getElementById('newsList').innerHTML = newsHTML;
            } catch (error) {
                console.error('Error loading news:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
            }
        }

        async function editNews(newsId) {
            try {
                const newsRef = ref(database, `news/${newsId}`);
                const snapshot = await get(newsRef);
                
                if (snapshot.exists()) {
                    const news = snapshot.val();
                    
                    // Show edit form
                    document.getElementById('addNewsForm').classList.remove('hidden');
                    document.getElementById('addNewsForm').innerHTML = `
                        <h3 class="text-lg font-semibold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h3>
                        <form onsubmit="updateNews(event, '${newsId}')">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label>
                                <input type="text" id="editNewsTitle" value="${news.title}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</label>
                                <textarea id="editNewsContent" rows="5" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">${news.content}</textarea>
                            </div>
                            <div class="flex space-x-4">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button type="button" onclick="cancelEditNews()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </form>
                    `;
                }
            } catch (error) {
                console.error('Error loading news for edit:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
            }
        }

        async function updateNews(event, newsId) {
            event.preventDefault();
            
            try {
                const updateData = {
                    title: document.getElementById('editNewsTitle').value,
                    content: document.getElementById('editNewsContent').value,
                    updated_by: currentUser,
                    updated_date: new Date().toISOString().split('T')[0]
                };
                
                const newsRef = ref(database, `news/${newsId}`);
                await update(newsRef, updateData);
                
                await logActivity(currentUser, '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£: ' + updateData.title);
                showMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                cancelEditNews();
                loadStaffNews();
            } catch (error) {
                console.error('Error updating news:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
            }
        }

        function cancelEditNews() {
            document.getElementById('addNewsForm').classList.add('hidden');
            document.getElementById('addNewsForm').innerHTML = `
                <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
                <form onsubmit="addNews(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label>
                        <input type="text" id="newsTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</label>
                        <textarea id="newsContent" rows="5" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button>
                        <button type="button" onclick="hideAddNewsForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </form>
            `;
        }

        async function deleteNews(newsId) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    const newsRef = ref(database, `news/${newsId}`);
                    await remove(newsRef);
                    
                    await logActivity(currentUser, '‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£: ' + newsId);
                    showMessage('‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    loadStaffNews();
                } catch (error) {
                    console.error('Error deleting news:', error);
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                }
            }
        }

        // Admin Dashboard
        function showAdminDashboard() {
            document.getElementById('app').innerHTML = `
                <div class="min-h-full bg-gray-50">
                    <nav class="bg-red-600 text-white p-4">
                        <div class="flex justify-between items-center">
                            <h1 class="text-xl font-bold">üßë‚Äçüíª ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h1>
                            <button onclick="logout()" class="bg-red-700 px-4 py-2 rounded hover:bg-red-800">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                        </div>
                    </nav>
                    
                    <div class="container mx-auto p-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <button onclick="showAdminUsers()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üë•</div>
                                <h3 class="font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                            </button>
                            <button onclick="showAdminAlumni()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üéì</div>
                                <h3 class="font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h3>
                            </button>
                            <button onclick="showAdminLogs()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üìã</div>
                                <h3 class="font-semibold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                            </button>
                            <button onclick="showAdminBackup()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg text-center">
                                <div class="text-3xl mb-2">üíæ</div>
                                <h3 class="font-semibold">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                            </button>
                        </div>
                        
                        <div id="adminContent" class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-2xl font-bold mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
                            <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function showAdminUsers() {
            try {
                const usersRef = ref(database, 'users');
                const snapshot = await get(usersRef);
                
                let usersHTML = `
                    <h2 class="text-2xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                    
                    <div class="mb-6">
                        <button onclick="showAddUserForm()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                    
                    <div id="addUserForm" class="hidden bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h3>
                        <form onsubmit="addUser(event)">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                    <input type="text" id="newUsername" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                    <input type="password" id="newPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
                                    <select id="newRole" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</option>
                                        <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                                        <option value="staff">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
                                        <option value="alumni">‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="newFullname" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            </div>
                            <div class="flex space-x-4">
                                <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                                <button type="button" onclick="hideAddUserForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </form>
                    </div>
                `;
                
                if (snapshot.exists()) {
                    const usersData = snapshot.val();
                    const usersList = Object.entries(usersData);
                    
                    usersHTML += `
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                    `;
                    
                    usersList.forEach(([username, user]) => {
                        const roleText = {
                            'admin': '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
                            'staff': '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£',
                            'alumni': '‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤'
                        };
                        
                        usersHTML += `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${username}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.fullname}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${roleText[user.role] || user.role}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    <div class="flex space-x-2">
                                        <button onclick="editUser('${username}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                        ${username !== 'admin' ? `<button onclick="deleteUser('${username}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>` : '<span class="text-gray-400 text-xs">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ</span>'}
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                    
                    usersHTML += `
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    usersHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</p>';
                }
                
                document.getElementById('adminContent').innerHTML = usersHTML;
            } catch (error) {
                console.error('Error loading users:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
            }
        }

        function showAddUserForm() {
            document.getElementById('addUserForm').classList.remove('hidden');
        }

        function hideAddUserForm() {
            document.getElementById('addUserForm').classList.add('hidden');
            document.getElementById('addUserForm').querySelector('form').reset();
        }

        async function addUser(event) {
            event.preventDefault();
            
            try {
                const username = document.getElementById('newUsername').value;
                const password = document.getElementById('newPassword').value;
                const role = document.getElementById('newRole').value;
                const fullname = document.getElementById('newFullname').value;
                
                // Check if username exists
                const userRef = ref(database, `users/${username}`);
                const snapshot = await get(userRef);
                
                if (snapshot.exists()) {
                    showMessage('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'error');
                    return;
                }
                
                // Create user
                await set(userRef, {
                    username: username,
                    password: password,
                    role: role,
                    fullname: fullname
                });
                
                await logActivity(currentUser, '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà: ' + username);
                showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                hideAddUserForm();
                showAdminUsers();
            } catch (error) {
                console.error('Error adding user:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
            }
        }

        async function editUser(username) {
            try {
                const userRef = ref(database, `users/${username}`);
                const snapshot = await get(userRef);
                
                if (snapshot.exists()) {
                    const user = snapshot.val();
                    
                    // Show edit form
                    document.getElementById('addUserForm').classList.remove('hidden');
                    document.getElementById('addUserForm').innerHTML = `
                        <h3 class="text-lg font-semibold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                        <form onsubmit="updateUser(event, '${username}')">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                    <input type="text" id="editUsername" value="${username}" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed">
                                    <p class="text-xs text-gray-500 mt-1">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                                    <input type="password" id="editPassword" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
                                    <select id="editRole" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                        <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                                        <option value="staff" ${user.role === 'staff' ? 'selected' : ''}>‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
                                        <option value="alumni" ${user.role === 'alumni' ? 'selected' : ''}>‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="editFullname" value="${user.fullname}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            </div>
                            <div class="flex space-x-4">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button type="button" onclick="cancelEditUser()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </form>
                    `;
                }
            } catch (error) {
                console.error('Error loading user for edit:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
            }
        }

        async function updateUser(event, username) {
            event.preventDefault();
            
            try {
                const updateData = {
                    fullname: document.getElementById('editFullname').value,
                    role: document.getElementById('editRole').value
                };
                
                // Only update password if provided
                const newPassword = document.getElementById('editPassword').value;
                if (newPassword.trim()) {
                    updateData.password = newPassword;
                }
                
                const userRef = ref(database, `users/${username}`);
                await update(userRef, updateData);
                
                await logActivity(currentUser, '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ' + username);
                showMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                cancelEditUser();
                showAdminUsers();
            } catch (error) {
                console.error('Error updating user:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
            }
        }

        function cancelEditUser() {
            document.getElementById('addUserForm').classList.add('hidden');
            document.getElementById('addUserForm').innerHTML = `
                <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h3>
                <form onsubmit="addUser(event)">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                            <input type="text" id="newUsername" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <input type="password" id="newPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
                            <select id="newRole" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</option>
                                <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                                <option value="staff">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
                                <option value="alumni">‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" id="newFullname" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                        <button type="button" onclick="hideAddUserForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </form>
            `;
        }

        async function deleteUser(username) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    const userRef = ref(database, `users/${username}`);
                    await remove(userRef);
                    
                    await logActivity(currentUser, '‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ' + username);
                    showMessage('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    showAdminUsers();
                } catch (error) {
                    console.error('Error deleting user:', error);
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
                }
            }
        }

        async function showAdminAlumni() {
            try {
                const alumniRef = ref(database, 'alumni');
                const snapshot = await get(alumniRef);
                
                let alumniHTML = `<h2 class="text-2xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>`;
                
                if (snapshot.exists()) {
                    const alumniData = snapshot.val();
                    const alumniList = Object.entries(alumniData);
                    
                    alumniHTML += `
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏´‡∏±‡∏™</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏≤‡∏Ç‡∏≤</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏õ‡∏µ‡∏à‡∏ö</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                    `;
                    
                    alumniList.forEach(([key, alumni]) => {
                        alumniHTML += `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${alumni.alumni_id}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.fullname}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.major}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.grad_year}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${alumni.email}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    <button onclick="deleteAlumni('${key}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    alumniHTML += `
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    alumniHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</p>';
                }
                
                document.getElementById('adminContent').innerHTML = alumniHTML;
            } catch (error) {
                console.error('Error loading alumni:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤', 'error');
            }
        }

        async function deleteAlumni(alumniKey) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    const alumniRef = ref(database, `alumni/${alumniKey}`);
                    await remove(alumniRef);
                    
                    await logActivity(currentUser, '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤: ' + alumniKey);
                    showMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    showAdminAlumni();
                } catch (error) {
                    console.error('Error deleting alumni:', error);
                    showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤', 'error');
                }
            }
        }

        async function showAdminLogs() {
            try {
                const logsRef = ref(database, 'system_logs');
                const snapshot = await get(logsRef);
                
                let logsHTML = `<h2 class="text-2xl font-bold mb-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>`;
                
                if (snapshot.exists()) {
                    const logsData = snapshot.val();
                    const logsList = Object.entries(logsData).reverse(); // ‡πÅ‡∏™‡∏î‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô
                    
                    logsHTML += `
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                    `;
                    
                    logsList.slice(0, 50).forEach(([key, log]) => { // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                        const timestamp = new Date(log.timestamp);
                        logsHTML += `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${timestamp.toLocaleDateString('th-TH')}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${timestamp.toLocaleTimeString('th-TH')}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${log.username}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${log.action}</td>
                            </tr>
                        `;
                    });
                    
                    logsHTML += `
                                </tbody>
                            </table>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">‡πÅ‡∏™‡∏î‡∏á 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                    `;
                } else {
                    logsHTML += '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>';
                }
                
                document.getElementById('adminContent').innerHTML = logsHTML;
            } catch (error) {
                console.error('Error loading logs:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'error');
            }
        }

        async function showAdminBackup() {
            document.getElementById('adminContent').innerHTML = `
                <h2 class="text-2xl font-bold mb-6">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4 text-blue-800">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                        <p class="text-gray-600 mb-4">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå JSON</p>
                        <button onclick="backupData()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </div>
                    
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4 text-green-800">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö</h3>
                        <div id="systemStats">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                    </div>
                </div>
                
                <div class="mt-6 bg-yellow-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-800">‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    <p class="text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                </div>
            `;
            
            loadSystemStats();
        }

        async function loadSystemStats() {
            try {
                const [usersSnapshot, alumniSnapshot, activitiesSnapshot, newsSnapshot, logsSnapshot] = await Promise.all([
                    get(ref(database, 'users')),
                    get(ref(database, 'alumni')),
                    get(ref(database, 'activities')),
                    get(ref(database, 'news')),
                    get(ref(database, 'system_logs'))
                ]);
                
                const stats = {
                    users: usersSnapshot.exists() ? Object.keys(usersSnapshot.val()).length : 0,
                    alumni: alumniSnapshot.exists() ? Object.keys(alumniSnapshot.val()).length : 0,
                    activities: activitiesSnapshot.exists() ? Object.keys(activitiesSnapshot.val()).length : 0,
                    news: newsSnapshot.exists() ? Object.keys(newsSnapshot.val()).length : 0,
                    logs: logsSnapshot.exists() ? Object.keys(logsSnapshot.val()).length : 0
                };
                
                document.getElementById('systemStats').innerHTML = `
                    <div class="space-y-2">
                        <p>üë• ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span class="font-semibold">${stats.users} ‡∏Ñ‡∏ô</span></p>
                        <p>üéì ‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤: <span class="font-semibold">${stats.alumni} ‡∏Ñ‡∏ô</span></p>
                        <p>üéâ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: <span class="font-semibold">${stats.activities} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></p>
                        <p>üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£: <span class="font-semibold">${stats.news} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></p>
                        <p>üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: <span class="font-semibold">${stats.logs} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading system stats:', error);
                document.getElementById('systemStats').innerHTML = '<p class="text-red-600">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</p>';
            }
        }

        async function backupData() {
            try {
                showMessage('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'success');
                
                const [usersSnapshot, alumniSnapshot, activitiesSnapshot, newsSnapshot, logsSnapshot] = await Promise.all([
                    get(ref(database, 'users')),
                    get(ref(database, 'alumni')),
                    get(ref(database, 'activities')),
                    get(ref(database, 'news')),
                    get(ref(database, 'system_logs'))
                ]);
                
                const backupData = {
                    backup_date: new Date().toISOString(),
                    users: usersSnapshot.exists() ? usersSnapshot.val() : {},
                    alumni: alumniSnapshot.exists() ? alumniSnapshot.val() : {},
                    activities: activitiesSnapshot.exists() ? activitiesSnapshot.val() : {},
                    news: newsSnapshot.exists() ? newsSnapshot.val() : {},
                    system_logs: logsSnapshot.exists() ? logsSnapshot.val() : {}
                };
                
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `alumni_system_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                await logActivity(currentUser, '‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö');
                showMessage('‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                console.error('Error backing up data:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        function logout() {
            currentUser = null;
            currentUserRole = null;
            showLoginPage();
        }

        // Make functions global
        window.showLoginForm = showLoginForm;
        window.showRegisterForm = showRegisterForm;
        window.handleLogin = handleLogin;
        window.handleRegister = handleRegister;
        window.logout = logout;
        
        // Alumni functions
        window.showAlumniProfile = showAlumniProfile;
        window.showAlumniSearch = showAlumniSearch;
        window.showAlumniNews = showAlumniNews;
        window.showAlumniActivities = showAlumniActivities;
        window.updateAlumniProfile = updateAlumniProfile;
        window.searchAlumni = searchAlumni;
        window.handleImageUpload = handleImageUpload;
        window.removeProfileImage = removeProfileImage;
        
        // Staff functions
        window.showStaffSearch = showStaffSearch;
        window.showStaffReports = showStaffReports;
        window.showStaffActivities = showStaffActivities;
        window.showStaffNews = showStaffNews;
        window.staffSearchAlumni = staffSearchAlumni;
        window.showAddActivityForm = showAddActivityForm;
        window.hideAddActivityForm = hideAddActivityForm;
        window.addActivity = addActivity;
        window.editActivity = editActivity;
        window.updateActivity = updateActivity;
        window.cancelEditActivity = cancelEditActivity;
        window.deleteActivity = deleteActivity;
        window.showAddNewsForm = showAddNewsForm;
        window.hideAddNewsForm = hideAddNewsForm;
        window.addNews = addNews;
        window.editNews = editNews;
        window.updateNews = updateNews;
        window.cancelEditNews = cancelEditNews;
        window.deleteNews = deleteNews;
        
        // Admin functions
        window.showAdminUsers = showAdminUsers;
        window.showAdminAlumni = showAdminAlumni;
        window.showAdminLogs = showAdminLogs;
        window.showAdminBackup = showAdminBackup;
        window.showAddUserForm = showAddUserForm;
        window.hideAddUserForm = hideAddUserForm;
        window.addUser = addUser;
        window.editUser = editUser;
        window.updateUser = updateUser;
        window.cancelEditUser = cancelEditUser;
        window.deleteUser = deleteUser;
        window.deleteAlumni = deleteAlumni;
        window.backupData = backupData;
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div id="app"></div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99389854663ed01e',t:'MTc2MTI5OTY5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
